---
author: Jerry Hsia
title: 使用composer管理php包
excerpt:
layout: post
views:
  - 100
category:
  - PHP
tags:
  - PHP
post_format: [ ]
---
在PHP包管理上面，PHP发展的很缓慢，导致的结果就是很少发现程序员会使用像PEAR这样的工具。相反，大多数开发人员会选择他们自己喜欢的框架来处理代码，比如DB交互、ORIM'S、Oauth、Amazon S3整合等。

缺点就是在转换框架的时候（或者根本不需要返回使用框架）就感觉像在做噩梦，因为涉及到使用新工具，你必须重新学习里面的一切东西，而这并不简单。OK，Composer来帮助你解决这些问题。

## 安装

Composer包含两大逻辑部分：一个是用来存储包，另一个是命令行应用程序，帮助你发现、下载、更新和分享代码。
{% highlight bash %}
cd /path/to/my/project  
curl -s http://getcomposer.org/installer | php
{% endhighlight %}
在项目列表中，会有一个composer.phar文件，里面包含了所有逻辑代码行工具。你可以通过运行下面代码来确定是否安装成功。
{% highlight bash %}
php composer.phar
{% endhighlight %}
把这个文件移到bin目录下，它允许你简化命令。
{% highlight bash %}
sudo mv composer.phar /usr/bin/composer
{% endhighlight %}
解析composer.json文件

如果你是一名Ruby程序员，你会觉得这个文件跟Gemfile文件很相似，或者你是一个Node程序员，那么会觉得和package.json文件很像。同样，Composer会根据你的应用需求用composer.json文件来指定设置和封装。
{% highlight json %}
{  
    "require": {  
        "kriswallsmith/assetic": "*"  
    },
    "config" : {  
        "vendor-dir" : "packages"  
    } 
}
{% endhighlight %}
安装依赖
{% highlight bash %}
composer install
{% endhighlight %}

## Composer的一些小技巧

### 仅更新单个库

只想更新某个特定的库，不想更新它的所有依赖，很简单：
{% highlight bash %}
composer update foo/bar
{% endhighlight %}

此外，这个技巧还可以用来解决“警告信息问题”。如：
Warning: The lock file is not up to date with the latest changes in composer.json, you may be getting outdated dependencies, run update to update them.
如果你编辑了composer.json，你应该会看到这样的信息。比如，如果你增加或更新了细节信息，比如库的描述、作者、更多参数，甚至仅仅增加了一个空格，都会改变文件的md5sum。然后Composer就会警告你哈希值和composer.lock中记载的不同。

那么我们该怎么办呢？update命令可以更新lock文件，但是如果仅仅增加了一些描述，应该是不打算更新任何库。这种情况下，只需update nothing：

{% highlight bash %}
$ composer update nothing
Loading composer repositories with package information
Updating dependencies
Nothing to install or update
Writing lock file
Generating autoload files
{% endhighlight %}

### 不编辑composer.json的情况下安装库

你可能会觉得每安装一个库都需要修改composer.json太麻烦，那么你可以直接使用require命令。
{% highlight bash %}
composer require "foo/bar:1.0.0"
{% endhighlight %}

### 为生产环境作准备

最后提醒一下，在部署代码到生产环境的时候，别忘了优化一下自动加载：
{% highlight bash %}
composer dump-autoload --optimize
{% endhighlight %}
安装包的时候可以同样使用--optimize-autoloader。不加这一选项，你可能会发现20%到25%的性能损失。

